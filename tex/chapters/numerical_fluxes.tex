\section{Numerical fluxes}
In this section we will study the numerical fluxes used to solve the SWE in 1D.
At each cell interface, we need to solve the Riemann problem~\eqref{eq:Riemann_problem} to find the numerical flux.
There are several numerical fluxes that can be used to solve the local Riemann problem, and we will consider some of them in this section.
The fluxes we will consider are the Godunov method with an exact Riemann solver, the HLL, HLLC, Rusanov, Lax-Friedrichs, Lax-Wendroff and FORCE fluxes.
All of them are later implemented and tested in the numerical experiments in \autoref{ch:numerical_results}.


\subsection*{Godunov method with exact Riemann solver}
%\addcontentsline{toc}{subsection}{Godunov method with exact Riemann solver}
We consider the Godunov Upwind method, which is a first-order accurate metod to solve non-linear systems of hyperbolic conservation laws~\cite{Toro2024}.
In the method we solve the non-linear Riemann problem at each cell interface.
The Godunov flux is given by
\begin{align*}
    \mathbf{F}_{i + \frac{1}{2}} = \mathbf{F}(\mathbf{U}_{i + \frac{1}{2}}),
\end{align*}
meaning that we solve the Riemann problem exactly to find $h^*$ and $u^*$, and then use these values to compute the flux as 
\begin{align*}
    \mathbf{F}_{i + \frac{1}{2}} = \begin{bmatrix}
        h^* u^* \\ h^* {(u^{*})}^2 + \frac{1}{2} g {(h^{*})}^2
    \end{bmatrix}.
\end{align*}

\subsection*{HLL}
%\addcontentsline{toc}{subsection}{HLL}
The HLL (Harten, Lax and van Leer) approach assumes a two-wave structure of the Riemann problem.
The solver is based on the data $\mathbf{U}_L := \mathbf{U}_i^n, \mathbf{U}_R := \mathbf{U}_{i+1}^n$ and fluxes $\mathbf{F}_L := \mathbf{F}(\mathbf{U}_L), \mathbf{F}_R := \mathbf{F}(\mathbf{U}_R)$.
The HLL flux is given by
\begin{align}\label{eq:HLL_flux}
    \mathbf{F}_{i + \frac{1}{2}} = \begin{cases}
        \mathbf{F}_L & \text{if } S_L \geq 0, \\
        \mathbf{F}^{HLL} \equiv \frac{S_R \mathbf{F}_L - S_L \mathbf{F}_R + S_L S_R (\mathbf{U}_R - \mathbf{U}_L)}{S_R - S_L} & \text{if } S_L \leq 0 \leq S_R, \\
        \mathbf{F}_R & \text{if } S_R \leq 0.
    \end{cases}
\end{align}
The wave speeds $S_L$ and $S_R$ must be estimated in some way, and one possibility is to use 
\begin{align*}
    S_L = u_L - a_L q_L, \quad S_R = u_R + a_R q_R,
\end{align*}
where $a_L = \sqrt{g h_L}, a_R = \sqrt{g h_R}$ and  $q_K (K=L, R)$ is given by 
\begin{align*}
    q_K = 
    \begin{cases}
        \sqrt{\frac{1}{2}\left( \frac{(\hat{h} + h_K) \hat{h}}{h_K^2} \right) } & \text{if } \hat{h} > h_K, \\
        1 & \text{if } \hat{h} \leq h_K.
    \end{cases}
\end{align*}
Here $\hat{h}$ is an estimate for the water depth in the star region, $h_*$.
In the two-rarefaction Riemann Solver, the water depth $h$ in the star region is given by
\begin{align}\label{eq:two_rarefaction_hstar}
    h_* = \frac{1}{g} {\left( \frac{1}{2} (a_L + a_R) + \frac{1}{4} (u_L - u_R)  \right)}^2,
\end{align}
which is what we use in this project for $\hat{h}$ in the HLL solver.
Since this is a two-wave model, it is complete for one dimensional problems, but for the augmented system of equations in two dimensions, the HLL solver is not complete, as it ignores the middle wave, the shear wave.
This motivates the use of the HLLC solver, which is a modification of the HLL solver.

\subsection*{HLLC}
%\addcontentsline{toc}{subsection}{HLLC}
The HLLC (Harten, Lax, van Leer, Contact) solver is an extension of the HLL solver, which includes the middle wave, i.e., it is a three-wave model.
In addition to the wave speeds $S_L$ and $S_R$, the HLLC solver also requires the speed of the middle wave $S^*$.
We can write the HLLC numerical flux as
\begin{align*}
    \mathbf{F}_{i+\frac{1}{2}}^{HLLC} = \begin{cases}
        \mathbf{F}_L & \text{if } 0 \leq S_L, \\
        \mathbf{F}_{*L} & \text{if } S_L \leq 0 \leq S^*, \\
        \mathbf{F}_{*R} & \text{if } S^* \leq 0 \leq S_R, \\
        \mathbf{F}_R & \text{if } S_R \leq 0.
    \end{cases}
\end{align*}
The fluxes $\mathbf{F}_{*L}$ and $\mathbf{F}_{*R}$ are given by
\begin{align*}
    &\mathbf{F}_{*L} = \mathbf{F}_L + S_L (\mathbf{U}_L - \mathbf{U}_{*L}),\\
    &\mathbf{F}_{*R} = \mathbf{F}_R + S_R (\mathbf{U}_R - \mathbf{U}_{*R}),
\end{align*}
and the middle states $\mathbf{U}_{*L}$ and $\mathbf{U}_{*R}$ are given by
\begin{align*}
    U_{*K} = h_K \left( \frac{S_K - u_K}{S_K - S_*}  \right)
    \begin{bmatrix}
        1 \\ S_* \\ \psi_K
    \end{bmatrix}.
\end{align*}
The function $\psi_K$ can represent either a passive scalar $\psi(x,t)$ or the velocity component $v(x,t)$ if we consider the two-dimensional shallow water equations.
Mathematically $\psi(x,t)$ and $v(x,t)$ behave identically.
An estimate for the middle wave speed $S^*$ can be calculated as
\begin{align*}
    S^* = \frac{S_L h_R(u_R - S_R) - S_R h_L (u_L - S_L)}{h_R (u_R - S_R) - h_L (u_L - S_L)},
\end{align*}
where $S_L$ and $S_R$ are the wave speeds of the left and right waves, respectively.

\subsection*{Rusanov}
%\addcontentsline{toc}{subsection}{Rusanov}
The Rusanov flux uses the HLL framework, but with a different choice of wave speeds.
To obtain the flux, we assume that an estimate $S^+$ for the positive wave speed is available.
Then we set 
\begin{align}\label{eq:Rusanov_flux_part1}
    S_L = -S^+, \quad S_R = S^+.
\end{align}
By substituting~\eqref{eq:Rusanov_flux_part1} into the $\mathbf{F}^{HLL}$ in~\eqref{eq:HLL_flux}, we obtain the Rusanov flux as
\begin{align}\label{eq:Rusanov_flux}
    \mathbf{F}_{i+\frac{1}{2}}^{Rus} = \frac{1}{2} \left( \mathbf{F}_{L} + \mathbf{F}_{R}  \right)
    - \frac{1}{2} S^+ \left( \mathbf{U}_R - \mathbf{U}_L \right),
\end{align}
where a simple estimate for the wave speed $S^+$ is given by
\begin{align*}
    S^+ = \max ( |S_L|, |S_R|).
\end{align*}
There are some requirement for $S^+$ in~\eqref{eq:Rusanov_flux} to ensure stability.
It must hold that 
\begin{align*}
    S^+ \leq \frac{\Delta x}{\Delta t},
\end{align*}
where $\frac{\Delta x}{\Delta t}$ is called the mesh speed.
%This Rusanov sheme is upwind and based on a one-wave model.
%Therefore it is an incomplete Riemann solver.

\subsection*{Lax-Friedrichs}
%\addcontentsline{toc}{subsection}{Lax-Friedrichs}
In the Lax-Friedrichs method, we use the Rusanov flux, but with a different choice of wave speed.
That is, we set the wave speed $S^+$ as the largest possible speed, while still ensuring stability, i.e.,
\begin{align}\label{eq:Lax-Friedrichs_wave_speed}
    S^+ = \frac{\Delta x}{\Delta t}.
\end{align}
By inserting the wave speed~\eqref{eq:Lax-Friedrichs_wave_speed} into the Rusanov flux~\eqref{eq:Rusanov_flux}, we obtain the Lax-Friedrichs flux as
\begin{align*}
    \mathbf{F}_{i+\frac{1}{2}}^{LF} = \frac{1}{2} \left( {\mathbf{F}}_{L} + {\mathbf{F}}_{R} \right) - \frac{1}{2} \frac{\Delta x}{\Delta t} \left( \mathbf{U}_R - \mathbf{U}_L \right),
\end{align*}
where $\mathbf{F}_L = \mathbf{F}(\mathbf{U}_L)$ and $\mathbf{F}_R = \mathbf{F}(\mathbf{U}_R)$.
The Lax-Friedrichs method is a centred method, which is first-order accurate.

\subsection*{Lax-Wendroff}
%\addcontentsline{toc}{subsection}{Lax-Wendroff}
There are several versions of the Lax-Wendroff flux, but in this thesis we will use the following flux:
\begin{equation}
    \begin{aligned}
        \mathbf{U}_{i+ \frac{1}{2}}^{LW} &= \frac{1}{2} \left( \mathbf{U}_{L} + \mathbf{U}_{R}  \right) - \frac{1}{2} \frac{\Delta t}{\Delta x} \left( {\mathbf{F}}_{R} - {\mathbf{F}}_{L} \right), \\
        \mathbf{F}_{i+\frac{1}{2}}^{LW} &= {{}\mathbf{F}{(\mathbf{U})}_{i+ \frac{1}{2}}^{LW}}.
    \end{aligned}
\end{equation}
The Lax-Wendroff method is a centred method, which is second-order accurate in space and time.

\subsection*{FORCE}
%\addcontentsline{toc}{subsection}{FORCE}
The FORCE scheme (First-Order Centred) is a combination of Lax-Friedrichs and Lax-Wendroffs fluxes.
The numerical flux is given by
\begin{align*}
    \mathbf{F}_{i+ \frac{1}{2}}^{FO} = \frac{1}{2} \left( \mathbf{F}_{i+ \frac{1}{2}}^{LF} + \mathbf{F}_{i + \frac{1}{2}}^{LW}  \right),
\end{align*}
where $\mathbf{F}_{i+ \frac{1}{2}}^{LF}$ is the Lax-Friedrichs flux and $\mathbf{F}_{i+ \frac{1}{2}}^{LW}$ is the Lax-Wendroff flux.
The FORCE scheme is first-order accurate.
It is possible to extend the FORCE scheme to multiple dimensions on structured meshes by using dimensional splitting.
